package controleur;

import java.awt.Point;
import java.io.IOException;
import java.util.*;

import javax.xml.parsers.ParserConfigurationException;

import org.xml.sax.SAXException;

import modele.DemandeDeLivraison;
import modele.Intersection;
import modele.Plan;

import vue.FenetreIHM;
import xml.DeserialiseurDemandeDeLivraisonXML;
import xml.DeserialiseurPlanXML;
import xml.ExceptionXML;

/**
 * 
 */
public class EtatLivraisonChargee extends EtatDefaut {

    /**
     * Default constructor
     */
    public EtatLivraisonChargee() {
    }

    public String toString(){
    	return "Etat Livraison Charg√©e";
    }
    
    /**
     * @param fenetre
     */
    public void ouvrirPlan(Plan plan) {
    	try {
    		plan.nettoiePlan();
    		DeserialiseurPlanXML.charger(plan);
    		Controleur.setEtatCourant(Controleur.etatPlanCharge);
		} catch (ParserConfigurationException | SAXException | IOException
				| ExceptionXML e) {
			System.out.println("Exception constructeur plan");			
		}
    }

    /**
     * @param fenetre
     */
    public void importerLivraison(FenetreIHM fenetre,DemandeDeLivraison demandeDeLivraison, Plan plan){
    	try {
    		DeserialiseurDemandeDeLivraisonXML.charger(demandeDeLivraison,plan);
            Controleur.setEtatCourant(Controleur.etatLivraisonChargee);
		} catch (ParserConfigurationException | SAXException | IOException
				| ExceptionXML e) {
			System.out.println("Exception constructeur livraisons");			
		}
    }

    /**
     * @param plan 
     * @param demandeDeLivraison
     */
    public void calculerTournee(FenetreIHM fenetre, Plan plan, DemandeDeLivraison demandeDeLivraison) {
        demandeDeLivraison.calculerTournee(plan);
        Controleur.setEtatCourant(Controleur.etatTourneeCalculee);
    }
    
    public void clicGauche(FenetreIHM fenetre, Plan plan, Point p){
        Intersection inter = plan.cherche(p,fenetre.getEchelleX(),fenetre.getEchelleY());
        if(inter != null){
	        fenetre.afficheMessage(inter.toString());
        }
        else{
        	fenetre.afficheMessage("Pas d'intersection ici !");
        }
    }

}